<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Nille's web game</title>
    <link rel="shortcut icon" href="favicon.ico">
</head>
<body>
<h1>程晨的网页五子棋</h1>

<canvas id="canvas" width="400" height="400"></canvas>

<script src="https://code.jquery.com/jquery-2.1.0.js"></script>

<script>
    let blOrWh = 0;
    let winFlag = 0;
    let matrix = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    ];


    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    //ctx.fillRect(0,0,10,10);//矩形

    //ctx.lineWidth = 4;
    //ctx.strokeRect(10,10,100,20);

    const writeMessage = function () {
        if (blOrWh)
            console.log("BLACK is next!");
        else
            console.log("WHITE is next!");
    };

    const drawBoard = function () {
        ctx.beginPath();
        for (let i = 0; i < 19; i++) {
            ctx.moveTo(10 + i * 20, 10);
            ctx.lineTo(10 + i * 20, 10 + 20 * 18);

            ctx.moveTo(10, 10 + i * 20);
            ctx.lineTo(10 + 20 * 18, 10 + i * 20);
        }
        ctx.stroke();
    };


    const placingStone = function (stoneColor, stoneX, stoneY) {
        if (matrix[stoneX][stoneY] === 0) {
            writeMessage();
            stoneColor = !stoneColor;
            ctx.beginPath();
            if (stoneColor) {
                ctx.fillStyle = "Blue";
                ctx.arc(10 + stoneX * 20, 10 + stoneY * 20, 10, 0, Math.PI * 2, false);
                matrix[stoneX][stoneY] = 1;
            } else {
                ctx.fillStyle = "white";
                ctx.arc(10 + stoneX * 20, 10 + stoneY * 20, 10, 0, Math.PI * 2, false);
                ctx.stroke();
                matrix[stoneX][stoneY] = 2;
            }
            ctx.fill();
        }
        return stoneColor;
    };

    const check0 = function (stoneX, stoneY) {
        if (matrix[stoneX - 1][stoneY] === matrix[stoneX][stoneY]) {
            if (matrix[stoneX - 2][stoneY] === matrix[stoneX][stoneY]) {
                if (matrix[stoneX - 3][stoneY] === matrix[stoneX][stoneY]) {
                    if (matrix[stoneX - 4][stoneY] === matrix[stoneX][stoneY]) {
                        return 1;
                    } else {
                        if (matrix[stoneX + 1][stoneY] !== matrix[stoneX][stoneY]) {
                            return 0;
                        }
                    }
                } else {
                    for (let w = 0; w < 2; w++) {
                        if (matrix[stoneX + w + 1][stoneY] !== matrix[stoneX][stoneY]) {
                            return 0;
                        }
                    }
                }
            } else {
                for (let w = 0; w < 3; w++) {
                    if (matrix[stoneX + w + 1][stoneY] !== matrix[stoneX][stoneY]) {
                        return 0;
                    }
                }
            }
        } else {
            for (let w = 0; w < 4; w++) {
                if (matrix[stoneX + w + 1][stoneY] !== matrix[stoneX][stoneY]) {
                    return 0;
                }
            }
        }
        return 1;
    };


    const check90 = function (stoneX, stoneY) {

        if (matrix[stoneX][stoneY - 1] === matrix[stoneX][stoneY]) {
            if (matrix[stoneX][stoneY - 2] === matrix[stoneX][stoneY]) {
                if (matrix[stoneX][stoneY - 3] === matrix[stoneX][stoneY]) {
                    if (matrix[stoneX][stoneY - 4] === matrix[stoneX][stoneY]) {
                        return 1;
                    } else {
                        if (matrix[stoneX][stoneY + 1] !== matrix[stoneX][stoneY]) {
                            return 0;
                        }
                    }
                } else {
                    for (let w = 0; w < 2; w++) {
                        if (matrix[stoneX][stoneY + w + 1] !== matrix[stoneX][stoneY]) {
                            return 0;
                        }
                    }
                }
            } else {
                for (let w = 0; w < 3; w++) {
                    if (matrix[stoneX][stoneY + w + 1] !== matrix[stoneX][stoneY]) {
                        return 0;
                    }
                }
            }
        } else {
            for (let w = 0; w < 4; w++) {
                if (matrix[stoneX][stoneY + w + 1] !== matrix[stoneX][stoneY]) {
                    return 0;
                }
            }
        }
    };


    drawBoard();

    $("#canvas").click(function (event) {
        //console.log(event.offsetX);

        let arcPosX, arcPosY;
        let mtxPosX, mtxPosY;

        for (let x = 0; x < 19; x++) {
            if ((Math.abs(event.offsetX - (10 + x * 20))) < 10) {
                arcPosX = 10 + x * 20;
                mtxPosX = x;
            }
            if ((Math.abs(event.offsetY - (10 + x * 20))) < 10) {
                arcPosY = 10 + x * 20;
                mtxPosY = x;
            }
        }


        blOrWh = placingStone(blOrWh, mtxPosX, mtxPosY);

        winFlag = check0(mtxPosX, mtxPosY);

        if (winFlag === 0) {
            winFlag = check90(mtxPosX, mtxPosY);
        }
        //
        if (winFlag === 0) {
            if (matrix[mtxPosX - 1][mtxPosY - 1] === matrix[mtxPosX][mtxPosY]) {
                if (matrix[mtxPosX - 2][mtxPosY - 2] === matrix[mtxPosX][mtxPosY]) {
                    if (matrix[mtxPosX - 3][mtxPosY - 3] === matrix[mtxPosX][mtxPosY]) {
                        if (matrix[mtxPosX - 4][mtxPosY - 4] === matrix[mtxPosX][mtxPosY]) {
                            winFlag = 1;
                        } else {
                            if (matrix[mtxPosX + 1][mtxPosY + 1] === matrix[mtxPosX][mtxPosY]) {
                                winFlag = 1;
                            } else {
                                winFlag = 0;
                            }
                        }
                    } else {
                        for (let w = 0; w < 2; w++) {
                            if (matrix[mtxPosX + w + 1][mtxPosY + w + 1] !== matrix[mtxPosX][mtxPosY]) {
                                winFlag = 0;
                                break;
                            } else {
                                winFlag = 1;
                            }
                        }
                    }
                } else {
                    for (let w = 0; w < 3; w++) {
                        if (matrix[mtxPosX + w + 1][mtxPosY + w + 1] !== matrix[mtxPosX][mtxPosY]) {
                            winFlag = 0;
                            break;
                        } else {
                            winFlag = 1;
                        }
                    }
                }
            } else {
                for (let w = 0; w < 4; w++) {
                    if (matrix[mtxPosX + w + 1][mtxPosY + w + 1] !== matrix[mtxPosX][mtxPosY]) {
                        winFlag = 0;
                        break;
                    } else {
                        winFlag = 1;
                    }
                }
            }
        }
        //
        if (winFlag === 0) {
            if (matrix[mtxPosX - 1][mtxPosY + 1] === matrix[mtxPosX][mtxPosY]) {
                if (matrix[mtxPosX - 2][mtxPosY + 2] === matrix[mtxPosX][mtxPosY]) {
                    if (matrix[mtxPosX - 3][mtxPosY + 3] === matrix[mtxPosX][mtxPosY]) {
                        if (matrix[mtxPosX - 4][mtxPosY + 4] === matrix[mtxPosX][mtxPosY]) {
                            winFlag = 1;
                        } else {
                            if (matrix[mtxPosX + 1][mtxPosY - 1] !== matrix[mtxPosX][mtxPosY]) {
                                winFlag = 0;
                            } else {
                                winFlag = 1;
                            }
                        }
                    } else {
                        for (let w = 0; w < 2; w++) {
                            if (matrix[mtxPosX + w + 1][mtxPosY - w - 1] !== matrix[mtxPosX][mtxPosY]) {
                                winFlag = 0;
                                break;
                            } else {
                                winFlag = 1;
                            }
                        }
                    }
                } else {
                    for (let w = 0; w < 3; w++) {
                        if (matrix[mtxPosX + w + 1][mtxPosY - w - 1] !== matrix[mtxPosX][mtxPosY]) {
                            winFlag = 0;
                            break;
                        } else {
                            winFlag = 1;
                        }
                    }
                }
            } else {
                for (let w = 0; w < 4; w++) {
                    if (matrix[mtxPosX + w + 1][mtxPosY - w - 1] !== matrix[mtxPosX][mtxPosY]) {
                        winFlag = 0;
                        break;
                    } else {
                        winFlag = 1;
                    }
                }
            }
        }

        if (winFlag === 1) {
            console.log("someone win");
            if (blOrWh)
                alert("black win!! refresh to restart!");
            else
                alert("white win!! refresh to restart!");
        }
    });
</script>
</body>
</html>
